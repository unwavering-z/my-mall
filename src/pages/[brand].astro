---
// src/pages/[brand].astro
import productData from '../data/products.json';
import '../styles/mall.css';

// 1. 告诉 Astro 根据 JSON 数据生成哪些路径
export async function getStaticPaths() {
  const { brands } = productData;
  // 排除首页(index)，为其他品牌生成独立页面
  return brands
    .filter(brand => brand.slug !== 'index')
    .map(brand => ({
      params: { brand: brand.slug }, // URL 里的名字，如 /yuexiang
      props: { brandId: brand.id }   // 传给页面的品牌 ID
    }));
}

// 2. 获取当前页面的参数
const { brand } = Astro.params;
const { brandId } = Astro.props;

// 3. 筛选当前品牌和产品数据
const currentBrand = productData.brands.find(b => b.id === brandId);
const displayProducts = productData.items.filter(item => item.brandId === brandId);
---

<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{currentBrand.name} - 2026春节团购</title>
</head>
<body>
    <header class="hero-banner">
        <img src="/hero-banner.png" alt="马年大吉" />
    </header>

    <main class="mall-container">
        <nav class="side-menu">
            {productData.brands.map((b) => (
                <a href={b.slug === 'index' ? '/' : `/${b.slug}`} 
                   class={b.id === brandId ? "active" : ""}>
                    {b.name}
                </a>
            ))}
        </nav>

        <section class="product-grid">
            <div class="grid">
                {displayProducts.map((product) => (
                    <a href={`/details/${product.detail}`} class="product-link">
                        <div class="product-card">
                            <img src={product.image} alt={product.name} />
                            <div class="info">
                                <h3>{product.name}</h3>
                                <p class="price">{product.price}</p>
                            </div>
                        </div>
                    </a>
                ))}
            </div>
        </section>
    </main>
</body>
</html>