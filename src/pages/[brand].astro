---
// src/pages/[brand].astro
import productData from '../data/products.json';
import '../styles/mall.css';
const { festival } = productData;
// 1. å‘Šè¯‰ Astro æ ¹æ® JSON æ•°æ®ç”Ÿæˆå“ªäº›è·¯å¾„
export async function getStaticPaths() {
  const { brands } = productData;
  // æ’é™¤é¦–é¡µ(index)ï¼Œä¸ºå…¶ä»–å“ç‰Œç”Ÿæˆç‹¬ç«‹é¡µé¢
  return brands
    .filter(brand => brand.slug !== 'index')
    .map(brand => ({
      params: { brand: brand.slug }, // URL é‡Œçš„åå­—ï¼Œå¦‚ /yuexiang
      props: { brandId: brand.id }   // ä¼ ç»™é¡µé¢çš„å“ç‰Œ ID
    }));
}

// 2. è·å–å½“å‰é¡µé¢çš„å‚æ•°
const { brand } = Astro.params;
const { brandId } = Astro.props;

// 3. ç­›é€‰å½“å‰å“ç‰Œå’Œäº§å“æ•°æ®
const currentBrand = productData.brands.find(b => b.id === brandId);
const displayProducts = productData.items.filter(item => item.brandId === brandId);
---

<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{currentBrand.name} - 2026ç«¯åˆå›¢è´­</title>
</head>
<body>
    <div class="festival-banner" id="countdown-banner">
  <span class="festival-name">ğŸ® {festival.name}</span>
  <span class="countdown-text">
    è·èŠ‚æ—¥è¿˜æœ‰ <strong id="days-count">--</strong> å¤©
  </span>
</div>

<script define:vars={{ targetDate: festival.targetDate }}>
  function updateCountdown() {
    const target = new Date(targetDate).getTime();
    const now = new Date().getTime();
    const gap = target - now;
    
    const d = Math.floor(gap / (1000 * 60 * 60 * 24));
    document.getElementById('days-count').innerText = d > 0 ? d : 0;
  }
  updateCountdown();
</script>

<style define:vars={{ themeColor: festival.themeColor }}>
  /* --- é¡¶éƒ¨å…¬å‘Šæ¡æ ·å¼ --- */
  .festival-banner {
    background: var(--themeColor);
    color: white;
    padding: 8px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    position: sticky;
    top: 0;
    z-index: 1001;
  }
  .festival-name { font-weight: bold; }
  #days-count { font-size: 16px; color: #ffeb3b; margin: 0 2px; }

  /* --- ä¾§è¾¹æ é«˜äº®ç²¾å‡†ä¿®å¤ --- */
  
  /* 1. æ”¹å˜å·¦ä¾§å°çª„æ¡çš„é¢œè‰² (å‡è®¾å®ƒæ˜¯é€šè¿‡ ::before æˆ– border å®ç°çš„) */
  :global(.side-menu a.active::before) {
    background-color: var(--themeColor) !important;
  }
  
  /* 2. å¦‚æœä½ çš„çª„æ¡æ˜¯ç”¨å·¦è¾¹æ¡† border-left å®ç°çš„ï¼Œç”¨è¿™ä¸€è¡Œ */
  :global(.side-menu a.active) {
    border-left-color: var(--themeColor) !important;
    background-color: transparent !important; /* å»æ‰å¤§é¢ç§¯èƒŒæ™¯è‰² */
    color: var(--themeColor) !important;       /* æ–‡å­—ä¹Ÿå˜æˆä¸»é¢˜è‰²ï¼Œä¸é€‰æ©™è‰² */
    font-weight: bold;
  }
</style>
    <header class="hero-banner">
        <img src="/hero-banner.png" alt="é©¬å¹´å¤§å‰" />
    </header>

    <main class="mall-container">
        <nav class="side-menu">
            {productData.brands.map((b) => (
                <a href={b.slug === 'index' ? '/' : `/${b.slug}`} 
                   class={b.id === brandId ? "active" : ""}>
                    {b.name}
                </a>
            ))}
        </nav>

        <section class="product-grid">
            <div class="grid">
                {displayProducts.map((product) => (
                    <a href={`/details/${product.detail}`} class="product-link">
                        <div class="product-card">
                            <img src={product.image} alt={product.name} />
                            <div class="info">
                                <h3>{product.name}</h3>
                                <p class="price">{product.price}</p>
                            </div>
                        </div>
                    </a>
                ))}
            </div>
        </section>
    </main>
</body>
</html>